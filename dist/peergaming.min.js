/**
 *	peergaming.min.js - v0.4.3 | 2013-06-02
 *	http://peergaming.net
 *	Copyright (c) 2013, Stefan DÃ¼hring
 *	MIT License
 */

(function(J,s,A){"undefined"!==typeof module?module.exports=A(s):"undefined"!==typeof define?define(J,function(){return A(s)}):s[J]=A(s)})("pg",this,function(J){function s(a){console.warn("[ERROR] ",a);console.warn(a.name+": "+a.message)}function A(a){t(m,a);return m}function t(a){for(var b,c,e=1,k=arguments.length;e<k;e++)for(c in b=arguments[e],b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a}function B(a,b){a.prototype=Object.create(b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}})}
function Ia(a){if("object"==typeof a){for(var b=Object.keys(a),c=[],e=0,k=b.length;e<k;e++)c[e]=a[b]+"/";return c.join("")}}function ha(a){var b=[],c;b.push.apply(b,arguments);for(b.shift();a.length;)c=a.shift(),"function"===typeof c&&c.apply(c,b)}function ra(a,b){var c=u[a].reference,e=sa(c),k=sa(b),d=[],g=[],f,h;f=0;for(h=e.length;f<h;f++)void 0==b[e[f]]&&g.push(e[f]);f=0;for(h=k.length;f<h;f++)void 0==c[k[f]]&&d.push(k[f]);if(d.length||g.length){e=0;for(k=d.length;e<k;e++)Ja(a,b,d[e]);e=0;for(k=
g.length;e<k;e++)delete c[g[e]]}setTimeout(ra,U,a,b)}function Ja(a,b,c){var e=function(b){function e(b){u[a].reference[c]=b;var d=u[a].callbacks,k,T;k=0;for(T=d.length;k<T;k++)d[k].apply(d[k],[c,b]);return b}function d(a,b){a[b]=function(){Array.prototype[b].apply(this,arguments);return e(a)}}if(b!==u[a].reference[c]){if("object"===typeof b)if(Array.isArray(b))b=t(ia(function(b,d){var k=u[a].reference[c];k[b]=d;return e(k)}),b);else for(var f="pop push reverse shift sort splice unshift".split(" "),
g=0,h=f.length;g<h;g++)d(b,f[g]);e(b)}};e(b[c]);Object.defineProperty(b,c,{enumerable:!0,configurable:!0,get:function(){return u[a].reference[c]},set:e})}function ta(a){if(!~a.indexOf("a=crypto")){for(var b=[],c=4;c--;)b.push(Math.random().toString(36).substr(2,10));a+="a=crypto:1 AES_CM_128_HMAC_SHA1_80 inline:"+b.join("")+"\r\n"}~a.indexOf("b=AS")&&(a=a.replace(/b=AS:([0-9]*)/,function(){return"b=AS:"+m.channelConfig.BANDWIDTH}));return a}function Ka(a,b,c){b={action:a,local:g.id,data:b,remote:this.info.remote};
t(b,c);c=this.ready;var e=this.channels;a||(a=Object.keys(e));Array.isArray(a)||(a=[a]);for(var d=0,T=a.length;d<T;d++)c&&e[a[d]]&&e[a[d]].send(b)}function ua(a,b){var c=va();C.player=g=new K(a,c);b&&b(g);g.join(c)}function va(){var a=d.location.hash,a=a.length?a.substr(3):V;return"/"===a.charAt(0)?a.substr(1):a}function wa(){var a=va(),b=a.split("/");D.route=E.route=a;if(!(1>b.length))if(a=b.shift()){if(F=a=!b[0].length?ja[a]||ja["*"]:W[a]||W["*"],X!==D.route)if(a){if(X){for(var b=Object.keys(h),
a=0,c=b.length;a<c;a++)p.disconnect(b[a]);Y.send({action:"change",data:X})}X=D.route}else throw Error("Missing channel/game handler !");}else d.location.hash="!/"+V.substr(1)}function xa(a){return function(b,c){"string"!==typeof b&&(c=b,b="*");var e=new a(b);(e instanceof x?W:ja)[b]=e;c(e);return e}}function L(a){this.init(a);this.match=function(){}}function x(a){this.init(a);this.info={};this.options={minPlayer:2,maxPlayer:8};W[a]=this}function ya(a){G=function(){G=null;setTimeout(function(){for(var a=
Object.keys(l),b=g.pos,c=0,e=a.length;c<e;c++)if(b+1===l[a[c]].pos){h[a[c]].send("start");break}this._start&&delete this._start}.bind(this),5*H)}.bind(this);if(a){a=h[a];for(var b=Object.keys(C.sync),c,e=0,d=b.length;e<d;e++)c=b[e],a.send("sync",{resync:!0,key:c,value:C.sync[c]},!0);G&&G()}}function M(a){function b(){c=d.performance.now();e=c-k;k=c;a(e);Z&&requestAnimationFrame(b)}if(!Z){Z=!0;za=a;var c=0,e=0,k=0;requestAnimationFrame(function(){k=d.performance.now();b()})}}function ka(a,b,c){if(c){if(!y[a]||
y[a].results[g.pos]!==b)la[a]=!0,C.sync[a]=b;delete y[a]}else if(!y[a])if(la[a])delete la[a];else{c=Object.keys(h);y[a]={list:c,results:[]};y[a].results[g.pos]=b;for(var e=0,d=c.length;e<d;e++)h[c[e]].send("sync",{key:a,value:b},!0)}}var d=window,q=document,ma=!!d.navigator.mozGetUserMedia,na=!!d.chrome,E=d.sessionStorage,La=d.localStorage,F="",v=[],h={},Y=null,p=null,oa=!1,f=null,D={},g=null,l={},N=[],U=null;d.performance?d.performance.now||(d.performance.now=d.performance.webkitNow):d.performance=
{now:Date().now()};if(!d.requestAnimationFrame)for(var j=["webkit","moz"],f=0,z=j.length;f<z&&!d.requestAnimationFrame;f++)d.requestAnimationFrame=d[j[f]+"RequestAnimationFrame"],d.cancelAnimationFrame=d[j[f]+"CancelAnimationFrame"]||d[j[f]+"CancelRequestAnimationFrame"];var $;if(!("hidden"in q)){j=["webkit","moz","ms","o"];q.state&&(j.length=0);f=0;for(z=j.length;f<z;f++)j[f]+"Hidden"in q&&(q.state=q[j[f]+"VisibilityState"],q.hidden=q[j[f]+"Hidden"],$=j[f]+"visibilitychange");$||($="visibilitychange")}d.URL||
(d.URL=d.webkitURL||d.msURL||d.oURL);!d.Blob&&!d.BlobBuilder&&(d.BlobBuilder=d.BlobBuilder||d.WebKitBlobBuilder||d.MozBlobBuilder||d.MSBlobBuilder||d.OBlobBuilder);if(!d.setImmediate){var f=d,Aa=[];d.addEventListener("message",function(){Aa.shift()()},!0);f.setImmediate=function(a){if("function"!==typeof a)throw Error("Invalid Argument");Aa.push(a);d.postMessage("setImmediate","*")}}navigator.getUserMedia||(navigator.getUserMedia=navigator.mozGetUserMedia||navigator.webkitGetUserMedia||navigator.msGetUserMedia);
"function"!==typeof d.RTCPeerConnection&&(d.RTCPeerConnection=d.mozRTCPeerConnection||d.webkitRTCPeerConnection);"function"!==typeof d.RTCSessionDescription&&(d.RTCSessionDescription=d.mozRTCSessionDescription);"function"!==typeof d.RTCIceCandidate&&(d.RTCIceCandidate=d.mozRTCIceCandidate);d.webkitRTCPeerConnection&&!d.webkitRTCPeerConnection.prototype.getLocalStreams&&(d.webkitRTCPeerConnection.prototype.getLocalStreams=function(){return this.localStreams},d.webkitRTCPeerConnection.prototype.getRemoteStreams=
function(){return this.remoteStreams},d.webkitMediaStream.prototype.getVideoTracks||(d.webkitMediaStream.prototype.getVideoTracks=function(){return this.videoTracks},d.webkitMediaStream.prototype.getAudioTracks=function(){return this.audioTracks}));j=["URL","Blob","crypto","RTCPeerConnection"];f=0;for(z=j.length;f<z;f++)j[f]in d||console.log("Missing: ",j[f]);if(!d.RTCPeerConnection)return alert("Your browser doesn't support PeerConnections yet.");if(ma)return alert("Unfortunately the Firefox support got broken with the last update.\n                         Please use Chrome at the moment and look forward for the next version!");
f=new Uint32Array(1);new Uint8Array(f.buffer);f[0]=255;d.clearDebug=function(){delete La.log};var Ma=J.pg,C=Object.create(null),f={codeName:"spicy-phoenix",full:"0.4.3",major:0,minor:4,dot:3},O=null,m={channelConfig:{BANDWIDTH:1048576,MAX_BYTES:1024,CHUNK_SIZE:600},socketConfig:{server:"ws://peergaming.net:61125"},peerConfig:{iceServers:[{url:!ma?"stun:stun.l.google.com:19302":"stun:23.21.150.121"}]},connectionConstraints:{optional:[{RtpDataChannels:!0}]},mediaConstraints:{mandatory:{OfferToReceiveAudio:!0,
OfferToReceiveVideo:!0},optional:[]},videoConstraints:{mandatory:{maxHeight:320,maxWidth:240},optional:[]}};A.noServer=function(a){"boolean"===typeof a&&a||(O=a)};var u=[],U=100,ia=function(){var a=[],b=Object.create(Object.prototype);a.push.apply(a,arguments);u.push({reference:{},callbacks:a});ra(u.length-1,b);return b},sa=Object.keys,P={},r=function(){this instanceof w?P[this.id]={}:this._events={};return this};r.prototype.on=function(a,b,c){if("function"===typeof b){a=a.split(" ");for(var e=this instanceof
w?P[this.id]:this._events,d=a.length,f;d--;)f=a[d],e[f]||(e[f]=[]),e[f].push([b,c]);return this}};r.prototype.once=function(a,b){this.on(a,function e(){this.off(a,e);b.apply(this,arguments)}.bind(this));return this};r.prototype.emit=function(a){var b=(this instanceof w?P[this.id]:this._events)[a];if(b)for(var c=Array.prototype.slice.call(arguments,1),e=b.length;e--;)b[e][0].apply(b[e][1],c||[]);return this};r.prototype.off=function(a,b){var c=this instanceof w?P[this.id]:this._events,e=c[a];if(e){if(b)for(c=
e.length;c--;){if(e[c]===b){e.splice(c,1);break}}else c[a].length=0;return this}};var Q=function(a){a||(a={});this.writeable=this.readable=a.readable;this.ready=!0;this.writeBuffer=[];this.readBuffer=[];r.call(this)};B(Q,r);Q.prototype.handle=function(a){a=a.data;var b=JSON.parse(a),c=this.readBuffer;if(void 0!==b.part){c.push(b.data);this.emit("data",b,c.length);if(0<b.part)return;a=c.join("");c.length=0}this.emit("end",a)};Q.prototype.write=function(a){this.writeBuffer.push(a);this.ready&&this.emit("write",
this.writeBuffer.shift());return this.ready};Q.prototype.pipe=function(a){this.on("data",function(b){a.handle(b)});return a};var ba=function(a,b){var c=a.label;this.info={label:c,remote:b};this.channel=a;this.stream=new Q({readable:!0,writeable:!0});this.actions=aa[c]||aa.custom;"function"===typeof this.actions&&(this.actions={end:this.actions});a.addEventListener("open",this.init.bind(this))};ba.prototype.init=function(a){for(var b=this.channel,c=this.actions,e=this.stream,d=h[this.info.remote],
f=["open","data","end","close","error"],g=0,l=f.length;g<l;g++)e.on(f[g],c[f[g]],d);e.on("write",function(a){b.send(a)});b.onmessage=e.handle.bind(e);b.onclose=function(){e.emit("close")};b.onerror=function(a){e.emit("error",a)};e.emit("open",a)};ba.prototype.send=function(a){a=JSON.stringify(a);if(a.length>m.channelConfig.MAX_BYTES){var b=a,c=m.channelConfig.CHUNK_SIZE,e=b.length;a=[];for(var d=0,f=c;d<e;)a.push(b.slice(d,f)),d=f,f=d+c;b=a.length;for(c=0;b--;)a[b]=JSON.stringify({part:c++,data:a[b]})}else a=
[a];b=0;for(c=a.length;b<c;b++)this.stream.write(a[b])};var aa={init:{open:function(){delete this.info.pending;this.send("init",{account:g.account,time:g.time,data:g.data,list:Object.keys(h)})},end:function(a){a=JSON.parse(a);var b=l[this.info.remote];a=a.data;t(b.data,a.data);b.time=a.time;b.account=a.account;p.check(a.list,this);p.setup(this.info.remote)},close:function(){p.disconnect(this.info.remote)}},register:function(a){a=JSON.parse(a);if(a.remote!==g.id)return!h[a.remote]?void 0:h[a.remote].send("register",
a.data,{action:a.action,local:a.local,remote:a.remote});p.set(a,this)},ping:function(a){a=JSON.parse(a);var b=a.data;if(!b.pong)return this.send("ping",{pong:!0,index:b.index});p.setup(a.local,b.index,b.pong)},start:function(a){function b(){if(!F._start)return setTimeout(b,H);F._start()}a=JSON.parse(a);if((a.data||{}).request)return ya(a.local);b()},update:function(a){a=JSON.parse(a);l[a.local].data[a.data.key]=a.data.value},sync:function(a){a=JSON.parse(a);var b=a.data;if(!b.resync){a=a.local;var c=
b.key,b=b.value;y[c]?(console.log("[CONFLICT]"),b=void 0):(ka(c,b,!0),b=h[a].send("sync",{resync:!0,key:c,value:b},!0));return b}ka(b.key,b.value,!0)},message:function(a){g.emit("message",a)},custom:function(a){a=JSON.parse(a);console.log(a.action)}},ca=function(){!pa("ws")&&!O&&(E.id?qa({action:"remove",data:E.id},function(){v.length&&(delete E.id,ha(v))}):ha(v))},Ba=function(a){a=JSON.parse(a.data);if(!a||!a.local)return!v.length?p.check(a):ha(v,a);p.set(a)},Na=function(a){if(a.eventPhase===EventSource.CLOSED)return Ca();
try{a.currentTarget.close(),ca()}catch(b){console.log(b)}throw Error(a.data);},Ca=function(){console.log("[SOCKET] - CLOSE")},qa=function(a,b){t(a,{local:g.id,origin:D.route});a=JSON.stringify(a);if(pa("http")){var c=a,e=new XMLHttpRequest;e.open("POST",m.socketConfig.server,!0);b&&(e.onload=function(a){e.onload=null;b(a.currentTarget.response)});e.setRequestHeader("Content-Type","text/plain; charset=UTF-8");e.send(c)}else{b&&v.push(b);if(O)return O(a);I.send(a)}},pa=function(a){return m.socketConfig.server.split(":")[0]===
a};ca();d.addEventListener("unload",ca);d.addEventListener("beforeunload",ca);var I=null,Y={init:function(a,b){E.id=a;I=new (pa("http")?EventSource:WebSocket)(m.socketConfig.server+"/?local="+a+"&origin="+b);I.addEventListener("error",Na);I.addEventListener("open",function(){I.addEventListener("message",Ba);I.addEventListener("close",Ca);qa({action:"lookup"},function(a){p.check(a)})})},send:qa,handle:Ba},n=function(a,b,c,e){this.info={local:a,remote:b,pending:!0};c&&(this.info.initiator=!0);e&&(this.info.transport=
e);this.channels={};this.init()};n.prototype.init=function(){this.conn=new RTCPeerConnection(m.peerConfig,m.connectionConstraints);this.checkStateChanges();this.receiveDataChannels();this.findICECandidates();this.info.initiator&&this.createOffer()};n.prototype.checkStateChanges=function(){var a=this.conn,b=Object.keys(aa).length;a.onnegotiationneeded=function(){--b||this.createOffer()}.bind(this);a.oniceconnectionstatechange=function(a){"disconnected"===a.currentTarget.iceConnectionState&&(this.info.pending?
this.closed=!0:p.disconnect(this.info.remote))}.bind(this);a.onsignalingstatechange=function(a){this.ready="stable"===a.currentTarget.signalingState}.bind(this)};n.prototype.receiveDataChannels=function(){this.conn.ondatachannel=function(a){a=a.channel;this.channels[a.label]=new ba(a,this.info.remote)}.bind(this)};n.prototype.findICECandidates=function(){this.conn.onicecandidate=function(a){a.candidate&&this.send("setIceCandidates",a.candidate)}.bind(this)};n.prototype.setIceCandidates=function(a){if(this.closed)throw Error("Can't set ICE candidates!");
var b=this.conn;if(b.remoteDescription||b.localDescription){this._candidates&&delete this._candidates;Array.isArray(a)||(a=[a]);for(var c=0,e=a.length;c<e;c++)b.addIceCandidate(new RTCIceCandidate(a[c]))}else this._candidates||(this._candidates=[]),this._candidates.push(a)};n.prototype.createOffer=function(){var a=this.conn;ma&&a.createDataChannel("[moz]");a.createOffer(function(b){b.sdp=ta(b.sdp);a.setLocalDescription(b,function(){this.send("setConfigurations",b)}.bind(this),s)}.bind(this),s,m.mediaConstraints)};
n.prototype.setConfigurations=function(a){var b=this.conn,c=new RTCSessionDescription(a);if(this.closed)throw Error("Underlying PeerConnection got closed too early!");b.setRemoteDescription(c,function(){this._candidates&&this.setIceCandidates(this._candidates);if("offer"===a.type)b.createAnswer(function(a){a.sdp=ta(a.sdp);b.setLocalDescription(a,function(){this.send("setConfigurations",a)}.bind(this),s)}.bind(this),null,m.mediaConstraints);else if(!Object.keys(this.channels).length)for(var c=Object.keys(aa),
d=0,f=c.length;d<f;d++)this.createDataChannel(c[d])}.bind(this),s)};n.prototype.createDataChannel=function(a){try{var b=this.conn.createDataChannel(a,{reliable:!1});this.channels[a]=new ba(b,this.info.remote)}catch(c){console.log("[Error] - Creating DataChannel (*)")}};n.prototype.send=function(a,b,c){if(this.info.pending){if(!c){c=this.info.remote;if(this.info.transport)return this.info.transport.send("register",b,{action:a,local:g.id,remote:c});Y.send({action:a,data:b,remote:c})}}else this.send=
Ka.bind(this),this.send(a,b)};n.prototype.close=function(a){var b=this.channels,c=Object.keys(b);a||(a=c);Array.isArray(a)||(a=[a]);for(var c=0,e=a.length;c<e;c++)b[a[c]].channel.close(),delete b[a[c]];Object.keys(b).length||this.conn.close()};var H=0,da={},R={},Da=function(){var a=Object.keys(l),b={};b[g.time]=g.id;for(var c=0,e=a.length;c<e;c++)b[l[a[c]].time]=a[c];var d=Object.keys(b).sort(function(a,b){return a-b}).map(function(a){return b[a]});if(d.length!==a.length+1)throw Error("[ERROR] Precision time conflict.");
c=N.length=0;for(e=d.length;c<e;c++)a=l[d[c]]||g,a.pos=N.push(a.data)-1},Ea={},Fa=0,p={check:function(a,b){if(a){Array.isArray(a)||(a=[a]);var c=g.id,e=a.pop();this.connect(e,!0,b);if(a.length)for(var d=0,f=a.length;d<f;d++)e=a[d],e===c||h[e]||(R[e]=b)}},connect:function(a,b,c){h[a]||a===g.id||(l[a]=new w({id:a}),h[a]=new n(g.id,a,b,c))},disconnect:function(a){var b=l[a];b&&(delete da[a],g.emit("disconnect",b),F.emit("leave",b),h[a].close(),N.splice(b.pos,1),delete l[a],delete h[a],Da())},set:function(a,
b){h[a.local]||this.connect(a.local,!1,b);h[a.local][a.action](a.data)},update:function(a,b){for(var c=Object.keys(h),e=0,d=c.length;e<d;e++)h[c[e]].send("update",{key:a,value:b},!0)},setup:function(a,b,c){function e(a,b){return a+b}if(c){c=Ea[a];c[b]=d.performance.now()-c[b];if(!oa){b=c[0];b=100-b;var f=Object.keys(l).length,j=Object.keys(R).length+f;b=~~(f*b/j);b<=Fa||F.emit("progress",Fa=b)}if(!(0<--c[0])){a=l[a].latency=c.reduce(e)/(c.length-1);H=Math.max(H,a);a=function(a){da[a.id]||(da[a.id]=
!0,g.emit("connection",a),F.emit("enter",a))};b=Object.keys(l);c=[];c[g.pos]=g;for(var j=0,m=b.length;j<m;j++)f=l[b[j]],c[f.pos]=f;if(b=Object.keys(R).pop())a=R[b],delete R[b],p.check(b,a);else{Da();j=0;for(m=c.length;j<m;j++)setTimeout(a,H,c[j])}}}else{c=function(a){setTimeout(function(){q.send("ping",{index:a},!0)},Math.random()*n)};var q=h[a],n=100;a=Ea[a]=[n];for(b=1;b<=n;b++)a[b]=d.performance.now(),c(b)}}};t(D,{route:null});var Oa={GITHUB:function(){},PERSONA:function(){var a=document.createElement("script");
a.addEventListener("load",function(){navigator.id.watch({loggedInUser:localStorage.user||"",onlogin:function(a){console.log(a)},onlogout:function(){}});navigator.id.request()});a.src="https://login.persona.org/include.js";document.getElementsByTagName("script")[0].parentNode.insertBefore(a)}},Ga={},Ha={},X=null,V="lobby/";d.addEventListener("hashchange",wa);d.addEventListener("popstate",function(){na&&(na=!na)});var ja={},z=xa(L);B(L,r);L.prototype.init=function(a){this.id=a;r.call(this)};L.prototype.config=
function(a){t(this.options,a)};var W={},G=null,j=xa(x);B(x,L);x.prototype.start=function(a){this._start=function(){a();oa=!0;ya.call(this)};var b=Object.keys(da).length;if(!(b<this.options.minPlayer))if(b===this.options.minPlayer)0===g.pos&&this._start();else if(b>this.options.minPlayer&&g.pos>=this.options.minPlayer)a:for(var b=Object.keys(l),c=g.pos,e=0,d=b.length;e<d;e++)if(c-1===l[b[e]].pos){h[b[e]].send("start",{request:!0},!0);break a}};x.prototype.end=function(){oa=!1};x.prototype.pause=function(){};
x.prototype.unpause=function(){};var ea=function(a,b,c,e){this.info={local:a,remote:b,pending:!0};c&&(this.info.initiator=!0);e&&(this.info.transport=e);this.channels={};this.init()};ea.prototype.init=function(){this.conn=new RTCPeerConnection(m.peerConfig,m.connectionConstraints);this.checkStateChanges();this.findICECandidates();this.info.initiator&&this.requestStream()};B(ea,n);ea.prototype.attachStream=function(){var a=this.conn;a.onaddstream=function(a){console.log("[MEDIA] - Added Stream");console.log(a)};
a.onremovestream=function(a){console.log("[MEDIA] - Removed Stream");URL.revokeObjectURL(a.stream)}};ea.prototype.requestStream=function(a){d.navigator.getUserMedia({audio:!0,video:!0},function(b){b.getVideoTracks();b.getAudioTracks();conn.addStream(b);if(a){var c=document.createElement("video");c.src=createObjectURL(b);c.autoplay=!0;document.getElementById(a).appendChild(c)}})};var w=function(a){this.init(a.id,a.account||{},a.data||{})};B(w,r);w.prototype.init=function(a,b,c){this.id=a;this.account=
b;this.data=c;this.pos=N.push(this.data)-1;r.call(this,a)};var S={},g={on:function(a,b,c){S[a]||(S[a]=[]);S[a].push([b,c])}},K=function(a,b){var c,e=new Uint8Array(1),d,f;c="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){d=crypto.getRandomValues(e)[0]%16;f="x"===a?d:d&3|8;return f.toString(16)});var g=ia(p.update);this.time=Date.now();this.init(c,a,g);Object.keys(S).length&&(P[this.id]=S);console.log("\n\t\t:: "+this.id+" ::\n");if(O)return setImmediate(function(){p.check(["SERVERLESS"])});
g=function(){Y.init(c,b)};if(!v.length)return g();v.push(g)};B(K,w);K.prototype.join=function(a,b){"string"!==typeof a&&(a=a.toString());"/"===a.charAt(0)&&(a=a.substr(1));var c=["!/",a,Ia(b)].join("");"/"!==c.charAt(c.length-1)&&(c+="/");if(c==="!/"+E.route)return wa();d.location.hash=c};K.prototype.send=function(a,b){b||(b=a,a=null);"string"!==typeof b&&(b=b.toString());a||(a=Object.keys(h));Array.isArray(a)||(a=[a]);for(var c=0,d=a.length;c<d;c++)h[a[c]].send("message",{local:this.name,msg:b},
!0)};K.prototype.media=function(){};var Z=!1,za=null;M.stop=function(){Z=!1};M.resume=function(){M(za)};q.addEventListener($,function(){var a=q.title.split("[PAUSE]").pop();q.hidden||M.stop();q.title=(q.hidden?"[PAUSE] - ":"")+a});var Pa=function(){fa=null;for(var a=Object.keys(ga),b,c=0,d=a.length;c<d;c++)b=a[c],ka(b,ga[b]),delete ga[b];G&&G()},ga={},fa=null,U=ia(function(a,b){ga[a]=b;fa&&clearTimeout(fa);fa=setTimeout(Pa,H)}),y={},la={};t(C,{noConflict:function(){J.pg=Ma;return this},VERSION:f,
info:D,config:A,login:function(a,b,c){"function"===typeof b&&(c=b,b=null);if(b)return b=b.toUpperCase(),Oa[b]?(ua({name:a},c),a=void 0):a=console.log("[ERROR] The chosen service is not supported yet."),a;ua({name:a},c)},player:g,peers:l,data:N,sync:U,loop:M,channel:z,game:j,routes:function(a,b){!b&&"string"===typeof a&&(b=a,a=null);a&&(Ga={},Ha={});b&&(V=b);return[Ga,Ha,V]}});return C});
