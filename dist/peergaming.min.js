/**
 *	peergaming.min.js - v0.4.0 | 2013-05-30
 *	http://peergaming.net
 *	Copyright (c) 2013, Stefan DÃ¼hring
 *	MIT License
 */

(function(D,t,z){"undefined"!==typeof module?module.exports=z(t):"undefined"!==typeof define?define(D,function(){return z(t)}):t[D]=z(t)})("pg",this,function(D){function t(a){console.warn("[ERROR] ",a);console.warn(a.name+": "+a.message)}function z(a){j.extend(m,a);return m}function ka(a,b){var c=v[a].reference,e=la(c),d=la(b),O=[],f=[],g,h;g=0;for(h=e.length;g<h;g++)void 0==b[e[g]]&&f.push(e[g]);g=0;for(h=d.length;g<h;g++)void 0==c[d[g]]&&O.push(d[g]);if(O.length||f.length){e=0;for(d=O.length;e<
d;e++)Aa(a,b,O[e]);e=0;for(d=f.length;e<d;e++)delete c[f[e]]}setTimeout(ka,Ba,a,b)}function Aa(a,b,c){var e=function(b){function e(b){v[a].reference[c]=b;var d=v[a].callbacks,p,f;p=0;for(f=d.length;p<f;p++)d[p].apply(d[p],[c,b]);return b}function d(a,b){a[b]=function(){Array.prototype[b].apply(this,arguments);return e(a)}}if(b!==v[a].reference[c]){if("object"===typeof b)if(Array.isArray(b))b=j.extend(ba(function(b,d){var p=v[a].reference[c];p[b]=d;return e(p)}),b);else for(var g="pop push reverse shift sort splice unshift".split(" "),
f=0,h=g.length;f<h;f++)d(b,g[f]);e(b)}};e(b[c]);Object.defineProperty(b,c,{enumerable:!0,configurable:!0,get:function(){return v[a].reference[c]},set:e})}function ma(a){if(!~a.indexOf("a=crypto")){for(var b=[],c=4;c--;)b.push(j.getToken());a+="a=crypto:1 AES_CM_128_HMAC_SHA1_80 inline:"+b.join("")+"\r\n"}~a.indexOf("b=AS")&&(a=a.replace(/b=AS:([0-9]*)/,function(){return"b=AS:"+m.channelConfig.BANDWIDTH}));return a}function Ca(a,b,c){b={action:a,local:h.id,data:b,remote:this.info.remote};j.extend(b,
c);c=this.ready;var e=this.channels;a||(a=Object.keys(e));Array.isArray(a)||(a=[a]);for(var d=0,f=a.length;d<f;d++)c&&e[a[d]]&&e[a[d]].send(b)}function na(a,b){var c=d.location.hash.substr(3)||P.substr(1);f.player=h=new E(a,c);b&&b(h);h.join(c)}function oa(){var a=d.location.hash.substr(3),b=a.split("/");F.route=A.currentRoute=a;if(!(1>b.length))if(a=b.shift()){if(G=a=!b[0].length?ca[a]||ca["*"]:Q[a]||Q["*"],R!==F.route)if(a){if(R){for(var b=Object.keys(k),a=0,c=b.length;a<c;a++)n.disconnect(b[a]);
S.send({action:"change",data:R})}R=F.route}else throw Error("Missing channel/game handler !");}else d.location.hash="!/"+P.substr(1)}function H(a){this.init(a);this.match=function(){}}function pa(a){return function(b,c){"string"!==typeof b&&(c=b,b="*");var e=new a(b);(e instanceof x?Q:ca)[b]=e;c(e);return e}}function x(a){this.init(a);this.info={};this.options={minPlayer:2,maxPlayer:8};Q[a]=this}function qa(a){B=function(){B=null;setTimeout(function(){for(var a=Object.keys(f.peers),b=h.pos,c=0,e=
a.length;c<e;c++)if(b+1===f.peers[a[c]].pos){k[a[c]].send("start");break}this._start&&delete this._start}.bind(this),5*T)}.bind(this);if(a){a=k[a];for(var b=Object.keys(f.sync),c,e=0,d=b.length;e<d;e++)c=b[e],a.send("sync",{resync:!0,key:c,value:f.sync[c]});B&&B()}}function I(a){function b(){c=d.performance.now();e=c-p;p=c;a(e);U&&requestAnimationFrame(b)}if(!U){U=!0;ra=a;var c=0,e=0,p=0;requestAnimationFrame(function(){p=d.performance.now();b()})}}function da(a,b,c){if(c){if(!y[a]||y[a].results[h.pos]!==
b)ea[a]=!0,f.sync[a]=b;delete y[a]}else if(!y[a])if(ea[a])delete ea[a];else{c=Object.keys(k);y[a]={list:c,results:[]};y[a].results[h.pos]=b;for(var e=0,d=c.length;e<d;e++)k[c[e]].send("sync",{key:a,value:b})}}var d=window,q=document,fa=!!d.navigator.mozGetUserMedia,ga=!!d.chrome,A=d.sessionStorage,Da=d.localStorage,sa=Math.random,h=null,F=null,G=null,k={};d.performance?d.performance.now||(d.performance.now=d.performance.webkitNow):d.performance={now:Date().now()};if(!d.requestAnimationFrame)for(var l=
["webkit","moz"],g=0,J=l.length;g<J&&!d.requestAnimationFrame;g++)d.requestAnimationFrame=d[l[g]+"RequestAnimationFrame"],d.cancelAnimationFrame=d[l[g]+"CancelAnimationFrame"]||d[l[g]+"CancelRequestAnimationFrame"];var V;if(!("hidden"in q)){l=["webkit","moz","ms","o"];q.state&&(l.length=0);g=0;for(J=l.length;g<J;g++)l[g]+"Hidden"in q&&(q.state=q[l[g]+"VisibilityState"],q.hidden=q[l[g]+"Hidden"],V=l[g]+"visibilitychange");V||(V="visibilitychange")}d.URL||(d.URL=d.webkitURL||d.msURL||d.oURL);!d.Blob&&
!d.BlobBuilder&&(d.BlobBuilder=d.BlobBuilder||d.WebKitBlobBuilder||d.MozBlobBuilder||d.MSBlobBuilder||d.OBlobBuilder);if(!d.setImmediate){var g=d,ta=[];d.addEventListener("message",function(){ta.shift()()},!0);g.setImmediate=function(a){if("function"!==typeof a)throw Error("Invalid Argument");ta.push(a);d.postMessage("setImmediate","*")}}navigator.getUserMedia||(navigator.getUserMedia=navigator.mozGetUserMedia||navigator.webkitGetUserMedia||navigator.msGetUserMedia);"function"!==typeof d.RTCPeerConnection&&
(d.RTCPeerConnection=d.mozRTCPeerConnection||d.webkitRTCPeerConnection);"function"!==typeof d.RTCSessionDescription&&(d.RTCSessionDescription=d.mozRTCSessionDescription);"function"!==typeof d.RTCIceCandidate&&(d.RTCIceCandidate=d.mozRTCIceCandidate);d.webkitRTCPeerConnection&&!d.webkitRTCPeerConnection.prototype.getLocalStreams&&(d.webkitRTCPeerConnection.prototype.getLocalStreams=function(){return this.localStreams},d.webkitRTCPeerConnection.prototype.getRemoteStreams=function(){return this.remoteStreams},
d.webkitMediaStream.prototype.getVideoTracks||(d.webkitMediaStream.prototype.getVideoTracks=function(){return this.videoTracks},d.webkitMediaStream.prototype.getAudioTracks=function(){return this.audioTracks}));l=["URL","Blob","crypto","RTCPeerConnection"];g=0;for(J=l.length;g<J;g++)l[g]in d||console.log("Missing: ",l[g]);if(!d.RTCPeerConnection)return alert("Your browser doesn't support PeerConnections yet.");if(fa)return alert("Unfortunately the Firefox support got broken with the last update.\n                         Please use Chrome at the moment and look forward for the next version!");
g=new Uint32Array(1);new Uint8Array(g.buffer);g[0]=255;d.clearDebug=function(){delete Da.log};var Ea=D.pg,f=Object.create(null);f.VERSION={codeName:"spicy-phoenix",full:"0.4.0",major:0,minor:4,dot:0};f.noConflict=function(){D.pg=Ea;return this};f.config=z;var K=null,m={channelConfig:{BANDWIDTH:1048576,MAX_BYTES:1024,CHUNK_SIZE:600},socketConfig:{server:"ws://peergaming.net:61125"},peerConfig:{iceServers:[{url:!fa?"stun:stun.l.google.com:19302":"stun:23.21.150.121"}]},connectionConstraints:{optional:[{RtpDataChannels:!0}]},
mediaConstraints:{mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0},optional:[]},videoConstraints:{mandatory:{maxHeight:320,maxWidth:240},optional:[]}};z.noServer=function(a){"boolean"===typeof a&&a||(K=a)};var j={check:function(a){return Object.prototype.toString.call(a).slice(8,-1)},extend:function(a){for(var b,c,e=1,d=arguments.length;e<d;e++)for(c in b=arguments[e],b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a},inherits:function(a,b){a.prototype=Object.create(b.prototype,{constructor:{value:a,
enumerable:!1,writable:!0,configurable:!0}})},getToken:function(){return sa().toString(36).substr(2,10)},createUID:function(){var a=new Uint8Array(1),b,c;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){b=crypto.getRandomValues(a)[0]%16;c="x"===e?b:b&3|8;return c.toString(16)})},createQuery:function(a){if("object"==typeof a){for(var b=Object.keys(a),c=[],e=0,d=b.length;e<d;e++)c[e]=a[b]+"/";return c.join("")}}},v=[],Ba=100,ba=function(){var a=[],b=Object.create(Object.prototype);
a.push.apply(a,arguments);v.push({reference:{},callbacks:a});ka(v.length-1,b);return b},la=Object.keys,g=function(){this.ready=!1;this.list=[]};g.prototype.add=function(a){"function"===typeof a&&this.list.push(a)};g.prototype.exec=function(){this.ready=!0;for(var a=Array.prototype.slice.call(arguments),b=this.list;b.length;)b.pop().apply(null,a)};g.prototype.clear=function(){this.list.length=0};var L={},s=function(){this instanceof w?L[this.id]={}:this._events={};return this};s.prototype.on=function(a,
b,c){if("function"===typeof b){a=a.split(" ");for(var e=this instanceof w?L[this.id]:this._events,d=a.length,f;d--;)f=a[d],e[f]||(e[f]=[]),e[f].push([b,c]);return this}};s.prototype.once=function(a,b){this.on(a,function e(){this.off(a,e);b.apply(this,arguments)}.bind(this));return this};s.prototype.emit=function(a){var b=(this instanceof w?L[this.id]:this._events)[a];if(b)for(var c=Array.prototype.slice.call(arguments,1),e=b.length;e--;)b[e][0].apply(b[e][1],c||[]);return this};s.prototype.off=function(a,
b){var c=this instanceof w?L[this.id]:this._events,e=c[a];if(e){if(b)for(c=e.length;c--;){if(e[c]===b){e.splice(c,1);break}}else c[a].length=0;return this}};var M=function(a){a||(a={});this.writeable=this.readable=a.readable;this.ready=!0;this.writeBuffer=[];this.readBuffer=[];s.call(this)};j.inherits(M,s);M.prototype.handle=function(a){a=a.data;var b=JSON.parse(a),c=this.readBuffer;if(void 0!==b.part){c.push(b.data);this.emit("data",b,c.length);if(0<b.part)return;a=c.join("");c.length=0}this.emit("end",
a)};M.prototype.write=function(a){this.writeBuffer.push(a);this.ready&&this.emit("write",this.writeBuffer.shift());return this.ready};M.prototype.pipe=function(a){this.on("data",function(b){a.handle(b)});return a};var X=function(a,b){var c=a.label;this.info={label:c,remote:b};this.channel=a;this.stream=new M({readable:!0,writeable:!0});this.actions=W[c]||W.custom;"function"===typeof this.actions&&(this.actions={end:this.actions});a.addEventListener("open",this.init.bind(this))};X.prototype.init=function(a){for(var b=
this.channel,c=this.actions,e=this.stream,d=k[this.info.remote],f=["open","data","end","close","error"],g=0,h=f.length;g<h;g++)e.on(f[g],c[f[g]],d);e.on("write",function(a){b.send(a)});b.onmessage=e.handle.bind(e);b.onclose=function(){e.emit("close")};b.onerror=function(a){e.emit("error",a)};e.emit("open",a)};X.prototype.send=function(a){a=JSON.stringify(a);if(a.length>m.channelConfig.MAX_BYTES){var b=a,c=m.channelConfig.CHUNK_SIZE,e=b.length;a=[];for(var d=0,f=c;d<e;)a.push(b.slice(d,f)),d=f,f=d+
c;b=a.length;for(c=0;b--;)a[b]=JSON.stringify({part:c++,data:a[b]})}else a=[a];b=0;for(c=a.length;b<c;b++)this.stream.write(a[b])};var W={init:{open:function(){delete this.info.pending;this.send("init",{account:h.account,time:h.time,data:h.data,list:Object.keys(k)})},end:function(a){a=JSON.parse(a);var b=f.peers[this.info.remote];a=a.data;j.extend(b.data,a.data);b.time=a.time;b.account=a.account;n.check(a.list,this);n.setup(this.info.remote)},close:function(){}},register:function(a){a=JSON.parse(a);
if(a.remote!==h.id){var b={action:a.action,local:a.local,remote:a.remote};return!k[a.remote]?console.log("[ERORR] - Missing",a.remote):k[a.remote].send("register",a.data,b)}if("update"===a.action)return console.log("[ERROR] - Update",a);n.set(a,this)},ping:function(a){a=JSON.parse(a);var b=a.data;if(!b.pong)return this.send("ping",{pong:!0,index:b.index});n.setup(a.local,b.index,b.pong)},start:function(a){function b(){if(!G._start)return setTimeout(b,T);G._start()}a=JSON.parse(a);if((a.data||{}).request)return qa(a.local);
b()},update:function(a){a=JSON.parse(a);f.peers[a.local].data[a.data.key]=a.data.value},sync:function(a){a=JSON.parse(a);var b=a.data;if(!b.resync){a=a.local;var c=b.key,b=b.value;y[c]?(console.log("[CONFLICT]"),b=void 0):(da(c,b,!0),b=k[a].send("sync",{resync:!0,key:c,value:b}));return b}da(b.key,b.value,!0)},message:function(a){h.emit("message",a)},custom:function(a){a=JSON.parse(a);console.log(a.action)}},u=new g,S,Y=function(){ha("ws")||K?u.ready=!0:A.id?ia({action:"remove",data:A.id},function(){u.ready||
(delete A.id,u.exec())}):u.exec()},ua=function(a){a=JSON.parse(a.data);if(!a||!a.local)return u.list.length?u.exec(a):n.check(a);n.set(a)},Fa=function(a){if(a.eventPhase===EventSource.CLOSED)return va();try{a.currentTarget.close(),Y()}catch(b){console.log(b)}throw Error(a.data);},va=function(){console.log("[SOCKET] - CLOSE")},ia=function(a,b){j.extend(a,{local:h.id,origin:F.route});a=JSON.stringify(a);if(ha("http")){var c=a,e=new XMLHttpRequest;e.open("POST",m.socketConfig.server,!0);b&&(e.onload=
function(a){e.onload=null;b(a.currentTarget.response)});e.setRequestHeader("Content-Type","text/plain; charset=UTF-8");e.send(c)}else{b&&u.add(b);if(K)return K(a);C.send(a)}},ha=function(a){return m.socketConfig.server.split(":")[0]===a};Y();d.addEventListener("unload",Y);d.addEventListener("beforeunload",Y);var C=null;S={init:function(a,b,c){A.id=a;C=new (ha("http")?EventSource:WebSocket)(m.socketConfig.server+"/?local="+a+"&origin="+b);C.addEventListener("error",Fa);C.addEventListener("open",function(){C.addEventListener("message",
ua);C.addEventListener("close",va);ia({action:"lookup"},function(a){c(a)})})},send:ia,handle:ua};var r=function(a,b,c,e){this.info={local:a,remote:b,pending:!0};c&&(this.info.initiator=!0);e&&(this.info.transport=e);this.channels={};this.init()};r.prototype.init=function(){this.conn=new RTCPeerConnection(m.peerConfig,m.connectionConstraints);this.checkStateChanges();this.receiveDataChannels();this.findICECandidates();this.info.initiator&&this.createOffer()};r.prototype.checkStateChanges=function(){var a=
this.conn,b=Object.keys(W).length;a.onnegotiationneeded=function(){--b||this.createOffer()}.bind(this);a.oniceconnectionstatechange=function(a){"disconnected"===a.currentTarget.iceConnectionState&&(this.info.pending?this.closed=!0:n.disconnect(this.info.remote))}.bind(this);a.onsignalingstatechange=function(a){this.ready="stable"===a.currentTarget.signalingState}.bind(this)};r.prototype.receiveDataChannels=function(){this.conn.ondatachannel=function(a){a=a.channel;this.channels[a.label]=new X(a,this.info.remote)}.bind(this)};
r.prototype.findICECandidates=function(){this.conn.onicecandidate=function(a){a.candidate&&this.send("setIceCandidates",a.candidate)}.bind(this)};r.prototype.setIceCandidates=function(a){var b=this.conn;if(b.remoteDescription||b.localDescription){this._candidates&&delete this._candidates;Array.isArray(a)||(a=[a]);for(var c=0,e=a.length;c<e;c++)b.addIceCandidate(new RTCIceCandidate(a[c]))}else this._candidates||(this._candidates=[]),this._candidates.push(a)};r.prototype.createOffer=function(){var a=
this.conn;fa&&a.createDataChannel("[moz]");a.createOffer(function(b){b.sdp=ma(b.sdp);a.setLocalDescription(b,function(){this.send("setConfigurations",b)}.bind(this),t)}.bind(this),t,m.mediaConstraints)};r.prototype.setConfigurations=function(a){var b=this.conn,c=new RTCSessionDescription(a);if(this.closed)return alert("[ERROR] - Connection got interuppted. Please reload !");b.setRemoteDescription(c,function(){this._candidates&&this.setIceCandidates(this._candidates);if("offer"===a.type)b.createAnswer(function(a){a.sdp=
ma(a.sdp);b.setLocalDescription(a,function(){this.send("setConfigurations",a)}.bind(this),t)}.bind(this),null,m.mediaConstraints);else if(!Object.keys(this.channels).length)for(var c=Object.keys(W),d=0,f=c.length;d<f;d++)this.createDataChannel(c[d])}.bind(this),t)};r.prototype.createDataChannel=function(a){try{var b=this.conn.createDataChannel(a,{reliable:!1});this.channels[a]=new X(b,this.info.remote)}catch(c){console.log("[Error] - Creating DataChannel (*)")}};r.prototype.send=function(a,b){if(this.info.pending){var c=
this.info.remote;if(this.info.transport)return this.info.transport.send("register",b,{action:a,local:h.id,remote:c});if("update"===a)return console.log("[ERROR] - Update",b);S.send({action:a,data:b,remote:c})}else this.send=Ca.bind(this),this.send(a,b)};r.prototype.close=function(a){var b=this.channels,c=Object.keys(b);a||(a=c);Array.isArray(a)||(a=[a]);for(var c=0,e=a.length;c<e;c++)b[a[c]].channel.close(),delete b[a[c]];Object.keys(b).length||this.conn.close()};var T=100,Z={},n,ja=function(a,b,
c){k[a]||(f.peers[a]=new w({id:a}),k[a]=new r(h.id,a,b,c))},wa=function(){var a=Object.keys(f.peers),b={};b[h.time]=h.id;for(var c=0,e=a.length;c<e;c++)b[f.peers[a[c]].time]=a[c];var d=Object.keys(b).sort(function(a,b){return a-b}).map(function(a){return b[a]});if(d.length!==a.length+1)return console.log("[ERROR] Precision time conflict.",d,a);c=f.data.length=0;for(e=d.length;c<e;c++)a=f.peers[d[c]]||h,a.pos=f.data.push(a.data)-1},xa={};n={check:function(a,b){if(a){Array.isArray(a)||(a=[a]);for(var c=
h.id,e,d=0,f=a.length;d<f;d++)e=a[d],e!==c&&!k[e]&&ja(e,!0,b)}},connect:ja,disconnect:function(a){var b=f.peers[a];delete Z[a];h.emit("disconnect",b);G.emit("leave",b);k[a].close();f.data.splice(b.pos,1);delete f.peers[a];delete k[a];wa()},set:function(a,b){k[a.local]||ja(a.local,!1,b);k[a.local][a.action](a.data)},update:function(a,b){for(var c=Object.keys(k),e=0,d=c.length;e<d;e++)k[c[e]].send("update",{key:a,value:b})},setup:function(a,b,c){function e(a,b){return a+b}if(c){if(c=xa[a],c[b]=d.performance.now()-
c[b],!(0<--c[0])){f.peers[a].latency=c.reduce(e)/(c.length-1);wa();a:{a=function(a){Z[a.id]||(Z[a.id]=!0,h.emit("connection",a),G.emit("enter",a))};b=Object.keys(f.peers);c=[];var g;c[h.pos]=h;for(var j=0,l=b.length;j<l;j++){g=f.peers[b[j]];if(!g.time)break a;c[g.pos]=g}j=0;for(l=c.length;j<l;j++)setTimeout(a,T,c[j])}}}else{b=function(a){setTimeout(function(){m.send("ping",{index:a})},sa()*n)};var m=k[a],n=100;a=xa[a]=[n];for(c=1;c<=n;c++)a[c]=d.performance.now(),b(c)}}};f.info=F={route:null};var Ga=
{GITHUB:function(){},PERSONA:function(){var a=document.createElement("script");a.addEventListener("load",function(){navigator.id.watch({loggedInUser:localStorage.user||"",onlogin:function(a){console.log(a)},onlogout:function(){}});navigator.id.request()});a.src="https://login.persona.org/include.js";document.getElementsByTagName("script")[0].parentNode.insertBefore(a)}};f.login=function(a,b,c){"function"===typeof b&&(c=b,b=null);if(b)return b=b.toUpperCase(),Ga[b]?(na({name:a},c),a=void 0):a=console.log("[ERROR] The chosen service is not supported yet."),
a;na({name:a},c)};var ya={},za={},R=null,P="/lobby/";f.routes=function(a,b){!b&&"string"===typeof a&&(b=a,a=null);a&&(ya={},za={});b&&(P=b);return[ya,za,P]};d.addEventListener("hashchange",oa);d.addEventListener("popstate",function(){ga&&(ga=!ga)});f.channel=pa(H);var ca={};j.inherits(H,s);H.prototype.init=function(a){this.id=a;s.call(this)};H.prototype.config=function(a){j.extend(this.options,a)};f.game=pa(x);var Q={},B=null;j.inherits(x,H);x.prototype.start=function(a){this._start=function(){a();
qa.call(this)};var b=Object.keys(Z).length;if(!(b<this.options.minPlayer))if(b===this.options.minPlayer)0===h.pos&&this._start();else if(b>this.options.minPlayer&&h.pos>=this.options.minPlayer)a:for(var b=Object.keys(f.peers),c=h.pos,d=0,g=b.length;d<g;d++)if(c-1===f.peers[b[d]].pos){k[b[d]].send("start",{request:!0});break a}};x.prototype.end=function(){};x.prototype.pause=function(){};x.prototype.unpause=function(){};g=function(a,b,c,d){this.info={local:a,remote:b,pending:!0};c&&(this.info.initiator=
!0);d&&(this.info.transport=d);this.channels={};this.init()};g.prototype.init=function(){this.conn=new RTCPeerConnection(m.peerConfig,m.connectionConstraints);this.checkStateChanges();this.findICECandidates();this.info.initiator&&this.requestStream()};j.inherits(g,r);g.prototype.attachStream=function(){var a=this.conn;a.onaddstream=function(a){console.log("[MEDIA] - Added Stream");console.log(a)};a.onremovestream=function(a){console.log("[MEDIA] - Removed Stream");URL.revokeObjectURL(a.stream)}};
g.prototype.requestStream=function(a){d.navigator.getUserMedia({audio:!0,video:!0},function(b){b.getVideoTracks();b.getAudioTracks();conn.addStream(b);if(a){var c=document.createElement("video");c.src=createObjectURL(b);c.autoplay=!0;document.getElementById(a).appendChild(c)}})};f.peers={};f.data=[];var w=function(a){this.init(a.id,a.account||{},a.data||{})};j.inherits(w,s);w.prototype.init=function(a,b,c){this.id=a;this.account=b;this.data=c;this.pos=f.data.push(this.data)-1;s.call(this,a)};var N=
{};f.player={on:function(a,b,c){N[a]||(N[a]=[]);N[a].push([b,c])}};var E=function(a,b){var c=j.createUID(),d=ba(n.update);this.time=Date.now();this.init(c,a,d);Object.keys(N).length&&(L[this.id]=N);console.log("\n\t\t:: "+this.id+" ::\n");if(K)return setImmediate(function(){n.check(["SERVERLESS"])});d=function(){S.init(c,b,n.check)};if(u.ready)return d();u.add(d)};j.inherits(E,w);E.prototype.join=function(a,b){"string"!==typeof a&&(a=a.toString());"/"===a.charAt(0)&&(a=a.substr(1));var c=["!/",a,
j.createQuery(b)].join("");"/"!==c.charAt(c.length-1)&&(c+="/");if(c==="!/"+A.currentRoute)return oa();d.location.hash=c};E.prototype.send=function(a,b){b||(b=a,a=null);"string"!==typeof b&&(b=b.toString());a||(a=Object.keys(k));Array.isArray(a)||(a=[a]);for(var c=0,d=a.length;c<d;c++)k[a[c]].send("message",{local:this.name,msg:b})};E.prototype.media=function(){};f.loop=I;var U=!1,ra=null;I.stop=function(){U=!1};I.resume=function(){I(ra)};q.addEventListener(V,function(){var a=q.title.split("[PAUSE]").pop();
q.hidden||I.stop();q.title=(q.hidden?"[PAUSE] - ":"")+a});var Ha=function(){$=null;for(var a=Object.keys(aa),b,c=0,d=a.length;c<d;c++)b=a[c],da(b,aa[b]),delete aa[b];B&&B()},aa={},$=null;f.sync=ba(function(a,b){aa[a]=b;$&&clearTimeout($);$=setTimeout(Ha,T)});var y={},ea={};return f});
