/**
 *	peergaming.min.js - v0.4.1 | 2013-06-02
 *	http://peergaming.net
 *	Copyright (c) 2013, Stefan DÃ¼hring
 *	MIT License
 */

(function(G,r,z){"undefined"!==typeof module?module.exports=z(r):"undefined"!==typeof define?define(G,function(){return z(r)}):r[G]=z(r)})("pg",this,function(G){function r(a){console.warn("[ERROR] ",a);console.warn(a.name+": "+a.message)}function z(a){s(l,a);return l}function s(a){for(var b,c,e=1,k=arguments.length;e<k;e++)for(c in b=arguments[e],b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a}function A(a,b){a.prototype=Object.create(b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}})}
function Ca(a){if("object"==typeof a){for(var b=Object.keys(a),c=[],e=0,k=b.length;e<k;e++)c[e]=a[b]+"/";return c.join("")}}function ea(a){var b=[],c;b.push.apply(b,arguments);for(b.shift();a.length;)c=a.shift(),"function"===typeof c&&c.apply(c,b)}function na(a,b){var c=t[a].reference,e=oa(c),k=oa(b),d=[],Q=[],f,g;f=0;for(g=e.length;f<g;f++)void 0==b[e[f]]&&Q.push(e[f]);f=0;for(g=k.length;f<g;f++)void 0==c[k[f]]&&d.push(k[f]);if(d.length||Q.length){e=0;for(k=d.length;e<k;e++)Ea(a,b,d[e]);e=0;for(k=
Q.length;e<k;e++)delete c[Q[e]]}setTimeout(na,R,a,b)}function Ea(a,b,c){var e=function(b){function e(b){t[a].reference[c]=b;var d=t[a].callbacks,k,f;k=0;for(f=d.length;k<f;k++)d[k].apply(d[k],[c,b]);return b}function d(a,b){a[b]=function(){Array.prototype[b].apply(this,arguments);return e(a)}}if(b!==t[a].reference[c]){if("object"===typeof b)if(Array.isArray(b))b=s(fa(function(b,d){var k=t[a].reference[c];k[b]=d;return e(k)}),b);else for(var f="pop push reverse shift sort splice unshift".split(" "),
g=0,j=f.length;g<j;g++)d(b,f[g]);e(b)}};e(b[c]);Object.defineProperty(b,c,{enumerable:!0,configurable:!0,get:function(){return t[a].reference[c]},set:e})}function pa(a){if(!~a.indexOf("a=crypto")){for(var b=[],c=4;c--;)b.push(Math.random().toString(36).substr(2,10));a+="a=crypto:1 AES_CM_128_HMAC_SHA1_80 inline:"+b.join("")+"\r\n"}~a.indexOf("b=AS")&&(a=a.replace(/b=AS:([0-9]*)/,function(){return"b=AS:"+l.channelConfig.BANDWIDTH}));return a}function Fa(a,b,c){b={action:a,local:f.id,data:b,remote:this.info.remote};
s(b,c);c=this.ready;var e=this.channels;a||(a=Object.keys(e));Array.isArray(a)||(a=[a]);for(var d=0,Da=a.length;d<Da;d++)c&&e[a[d]]&&e[a[d]].send(b)}function qa(a,b){var c=d.location.hash.substr(3)||S.substr(1);B.player=f=new H(a,c);b&&b(f);f.join(c)}function ra(){var a=d.location.hash.substr(3),b=a.split("/");C.route=D.currentRoute=a;if(!(1>b.length))if(a=b.shift()){if(I=a=!b[0].length?ga[a]||ga["*"]:T[a]||T["*"],U!==C.route)if(a){if(U){for(var b=Object.keys(j),a=0,c=b.length;a<c;a++)MANAGER.disconnect(b[a]);
SOCKET.send({action:"change",data:U})}U=C.route}else throw Error("Missing channel/game handler !");}else d.location.hash="!/"+S.substr(1)}function sa(a){return function(b,c){"string"!==typeof b&&(c=b,b="*");var e=new a(b);(e instanceof w?T:ga)[b]=e;c(e);return e}}function J(a){this.init(a);this.match=function(){}}function w(a){this.init(a);this.info={};this.options={minPlayer:2,maxPlayer:8};T[a]=this}function ta(a){E=function(){E=null;setTimeout(function(){for(var a=Object.keys(m),b=f.pos,c=0,e=a.length;c<
e;c++)if(b+1===m[a[c]].pos){j[a[c]].send("start");break}this._start&&delete this._start}.bind(this),5*V)}.bind(this);if(a){a=j[a];for(var b=Object.keys(B.sync),c,e=0,d=b.length;e<d;e++)c=b[e],a.send("sync",{resync:!0,key:c,value:B.sync[c]});E&&E()}}function K(a){function b(){c=d.performance.now();e=c-k;k=c;a(e);W&&requestAnimationFrame(b)}if(!W){W=!0;ua=a;var c=0,e=0,k=0;requestAnimationFrame(function(){k=d.performance.now();b()})}}function ha(a,b,c){if(c){if(!x[a]||x[a].results[f.pos]!==b)ia[a]=
!0,B.sync[a]=b;delete x[a]}else if(!x[a])if(ia[a])delete ia[a];else{c=Object.keys(j);x[a]={list:c,results:[]};x[a].results[f.pos]=b;for(var e=0,d=c.length;e<d;e++)j[c[e]].send("sync",{key:a,value:b})}}var d=window,p=document,ja=!!d.navigator.mozGetUserMedia,ka=!!d.chrome,D=d.sessionStorage,Ga=d.localStorage,I="",u=[],j={},g=MANAGER=SOCKET=null,C={},f=null,m={},L=[],R=null;d.performance?d.performance.now||(d.performance.now=d.performance.webkitNow):d.performance={now:Date().now()};if(!d.requestAnimationFrame)for(var h=
["webkit","moz"],g=0,y=h.length;g<y&&!d.requestAnimationFrame;g++)d.requestAnimationFrame=d[h[g]+"RequestAnimationFrame"],d.cancelAnimationFrame=d[h[g]+"CancelAnimationFrame"]||d[h[g]+"CancelRequestAnimationFrame"];var X;if(!("hidden"in p)){h=["webkit","moz","ms","o"];p.state&&(h.length=0);g=0;for(y=h.length;g<y;g++)h[g]+"Hidden"in p&&(p.state=p[h[g]+"VisibilityState"],p.hidden=p[h[g]+"Hidden"],X=h[g]+"visibilitychange");X||(X="visibilitychange")}d.URL||(d.URL=d.webkitURL||d.msURL||d.oURL);!d.Blob&&
!d.BlobBuilder&&(d.BlobBuilder=d.BlobBuilder||d.WebKitBlobBuilder||d.MozBlobBuilder||d.MSBlobBuilder||d.OBlobBuilder);if(!d.setImmediate){var g=d,va=[];d.addEventListener("message",function(){va.shift()()},!0);g.setImmediate=function(a){if("function"!==typeof a)throw Error("Invalid Argument");va.push(a);d.postMessage("setImmediate","*")}}navigator.getUserMedia||(navigator.getUserMedia=navigator.mozGetUserMedia||navigator.webkitGetUserMedia||navigator.msGetUserMedia);"function"!==typeof d.RTCPeerConnection&&
(d.RTCPeerConnection=d.mozRTCPeerConnection||d.webkitRTCPeerConnection);"function"!==typeof d.RTCSessionDescription&&(d.RTCSessionDescription=d.mozRTCSessionDescription);"function"!==typeof d.RTCIceCandidate&&(d.RTCIceCandidate=d.mozRTCIceCandidate);d.webkitRTCPeerConnection&&!d.webkitRTCPeerConnection.prototype.getLocalStreams&&(d.webkitRTCPeerConnection.prototype.getLocalStreams=function(){return this.localStreams},d.webkitRTCPeerConnection.prototype.getRemoteStreams=function(){return this.remoteStreams},
d.webkitMediaStream.prototype.getVideoTracks||(d.webkitMediaStream.prototype.getVideoTracks=function(){return this.videoTracks},d.webkitMediaStream.prototype.getAudioTracks=function(){return this.audioTracks}));h=["URL","Blob","crypto","RTCPeerConnection"];g=0;for(y=h.length;g<y;g++)h[g]in d||console.log("Missing: ",h[g]);if(!d.RTCPeerConnection)return alert("Your browser doesn't support PeerConnections yet.");if(ja)return alert("Unfortunately the Firefox support got broken with the last update.\n                         Please use Chrome at the moment and look forward for the next version!");
g=new Uint32Array(1);new Uint8Array(g.buffer);g[0]=255;d.clearDebug=function(){delete Ga.log};var Ha=G.pg,B=Object.create(null),g={codeName:"spicy-phoenix",full:"0.4.1",major:0,minor:4,dot:1},M=null,l={channelConfig:{BANDWIDTH:1048576,MAX_BYTES:1024,CHUNK_SIZE:600},socketConfig:{server:"ws://peergaming.net:61125"},peerConfig:{iceServers:[{url:!ja?"stun:stun.l.google.com:19302":"stun:23.21.150.121"}]},connectionConstraints:{optional:[{RtpDataChannels:!0}]},mediaConstraints:{mandatory:{OfferToReceiveAudio:!0,
OfferToReceiveVideo:!0},optional:[]},videoConstraints:{mandatory:{maxHeight:320,maxWidth:240},optional:[]}};z.noServer=function(a){"boolean"===typeof a&&a||(M=a)};var t=[],R=100,fa=function(){var a=[],b=Object.create(Object.prototype);a.push.apply(a,arguments);t.push({reference:{},callbacks:a});na(t.length-1,b);return b},oa=Object.keys,N={},q=function(){this instanceof v?N[this.id]={}:this._events={};return this};q.prototype.on=function(a,b,c){if("function"===typeof b){a=a.split(" ");for(var e=this instanceof
v?N[this.id]:this._events,d=a.length,f;d--;)f=a[d],e[f]||(e[f]=[]),e[f].push([b,c]);return this}};q.prototype.once=function(a,b){this.on(a,function e(){this.off(a,e);b.apply(this,arguments)}.bind(this));return this};q.prototype.emit=function(a){var b=(this instanceof v?N[this.id]:this._events)[a];if(b)for(var c=Array.prototype.slice.call(arguments,1),e=b.length;e--;)b[e][0].apply(b[e][1],c||[]);return this};q.prototype.off=function(a,b){var c=this instanceof v?N[this.id]:this._events,e=c[a];if(e){if(b)for(c=
e.length;c--;){if(e[c]===b){e.splice(c,1);break}}else c[a].length=0;return this}};var O=function(a){a||(a={});this.writeable=this.readable=a.readable;this.ready=!0;this.writeBuffer=[];this.readBuffer=[];q.call(this)};A(O,q);O.prototype.handle=function(a){a=a.data;var b=JSON.parse(a),c=this.readBuffer;if(void 0!==b.part){c.push(b.data);this.emit("data",b,c.length);if(0<b.part)return;a=c.join("");c.length=0}this.emit("end",a)};O.prototype.write=function(a){this.writeBuffer.push(a);this.ready&&this.emit("write",
this.writeBuffer.shift());return this.ready};O.prototype.pipe=function(a){this.on("data",function(b){a.handle(b)});return a};var Z=function(a,b){var c=a.label;this.info={label:c,remote:b};this.channel=a;this.stream=new O({readable:!0,writeable:!0});this.actions=Y[c]||Y.custom;"function"===typeof this.actions&&(this.actions={end:this.actions});a.addEventListener("open",this.init.bind(this))};Z.prototype.init=function(a){for(var b=this.channel,c=this.actions,e=this.stream,d=j[this.info.remote],f=["open",
"data","end","close","error"],g=0,h=f.length;g<h;g++)e.on(f[g],c[f[g]],d);e.on("write",function(a){b.send(a)});b.onmessage=e.handle.bind(e);b.onclose=function(){e.emit("close")};b.onerror=function(a){e.emit("error",a)};e.emit("open",a)};Z.prototype.send=function(a){a=JSON.stringify(a);if(a.length>l.channelConfig.MAX_BYTES){var b=a,c=l.channelConfig.CHUNK_SIZE,e=b.length;a=[];for(var d=0,f=c;d<e;)a.push(b.slice(d,f)),d=f,f=d+c;b=a.length;for(c=0;b--;)a[b]=JSON.stringify({part:c++,data:a[b]})}else a=
[a];b=0;for(c=a.length;b<c;b++)this.stream.write(a[b])};var Y={init:{open:function(){delete this.info.pending;this.send("init",{account:f.account,time:f.time,data:f.data,list:Object.keys(j)})},end:function(a){a=JSON.parse(a);var b=m[this.info.remote];a=a.data;s(b.data,a.data);b.time=a.time;b.account=a.account;MANAGER.check(a.list,this);MANAGER.setup(this.info.remote)},close:function(){}},register:function(a){a=JSON.parse(a);if(a.remote!==f.id){var b={action:a.action,local:a.local,remote:a.remote};
return!j[a.remote]?console.log("[ERORR] - Missing",a.remote):j[a.remote].send("register",a.data,b)}if("update"===a.action)return console.log("[ERROR] - Update",a);MANAGER.set(a,this)},ping:function(a){a=JSON.parse(a);var b=a.data;if(!b.pong)return this.send("ping",{pong:!0,index:b.index});MANAGER.setup(a.local,b.index,b.pong)},start:function(a){function b(){if(!I._start)return setTimeout(b,V);I._start()}a=JSON.parse(a);if((a.data||{}).request)return ta(a.local);b()},update:function(a){a=JSON.parse(a);
m[a.local].data[a.data.key]=a.data.value},sync:function(a){a=JSON.parse(a);var b=a.data;if(!b.resync){a=a.local;var c=b.key,b=b.value;x[c]?(console.log("[CONFLICT]"),b=void 0):(ha(c,b,!0),b=j[a].send("sync",{resync:!0,key:c,value:b}));return b}ha(b.key,b.value,!0)},message:function(a){f.emit("message",a)},custom:function(a){a=JSON.parse(a);console.log(a.action)}},$=function(){!la("ws")&&!M&&(D.id?ma({action:"remove",data:D.id},function(){u.length&&(delete D.id,ea(u))}):ea(u))},wa=function(a){a=JSON.parse(a.data);
if(!a||!a.local)return!u.length?MANAGER.check(a):ea(u,a);MANAGER.set(a)},Ia=function(a){if(a.eventPhase===EventSource.CLOSED)return xa();try{a.currentTarget.close(),$()}catch(b){console.log(b)}throw Error(a.data);},xa=function(){console.log("[SOCKET] - CLOSE")},ma=function(a,b){s(a,{local:f.id,origin:C.route});a=JSON.stringify(a);if(la("http")){var c=a,e=new XMLHttpRequest;e.open("POST",l.socketConfig.server,!0);b&&(e.onload=function(a){e.onload=null;b(a.currentTarget.response)});e.setRequestHeader("Content-Type",
"text/plain; charset=UTF-8");e.send(c)}else{b&&u.push(b);if(M)return M(a);F.send(a)}},la=function(a){return l.socketConfig.server.split(":")[0]===a};$();d.addEventListener("unload",$);d.addEventListener("beforeunload",$);var F=null;SOCKET={init:function(a,b){D.id=a;F=new (la("http")?EventSource:WebSocket)(l.socketConfig.server+"/?local="+a+"&origin="+b);F.addEventListener("error",Ia);F.addEventListener("open",function(){F.addEventListener("message",wa);F.addEventListener("close",xa);ma({action:"lookup"},
function(a){MANAGER.check(a)})})},send:ma,handle:wa};var n=function(a,b,c,e){this.info={local:a,remote:b,pending:!0};c&&(this.info.initiator=!0);e&&(this.info.transport=e);this.channels={};this.init()};n.prototype.init=function(){this.conn=new RTCPeerConnection(l.peerConfig,l.connectionConstraints);this.checkStateChanges();this.receiveDataChannels();this.findICECandidates();this.info.initiator&&this.createOffer()};n.prototype.checkStateChanges=function(){var a=this.conn,b=Object.keys(Y).length;a.onnegotiationneeded=
function(){--b||this.createOffer()}.bind(this);a.oniceconnectionstatechange=function(a){"disconnected"===a.currentTarget.iceConnectionState&&(this.info.pending?this.closed=!0:MANAGER.disconnect(this.info.remote))}.bind(this);a.onsignalingstatechange=function(a){this.ready="stable"===a.currentTarget.signalingState}.bind(this)};n.prototype.receiveDataChannels=function(){this.conn.ondatachannel=function(a){a=a.channel;this.channels[a.label]=new Z(a,this.info.remote)}.bind(this)};n.prototype.findICECandidates=
function(){this.conn.onicecandidate=function(a){a.candidate&&this.send("setIceCandidates",a.candidate)}.bind(this)};n.prototype.setIceCandidates=function(a){var b=this.conn;if(b.remoteDescription||b.localDescription){this._candidates&&delete this._candidates;Array.isArray(a)||(a=[a]);for(var c=0,e=a.length;c<e;c++)b.addIceCandidate(new RTCIceCandidate(a[c]))}else this._candidates||(this._candidates=[]),this._candidates.push(a)};n.prototype.createOffer=function(){var a=this.conn;ja&&a.createDataChannel("[moz]");
a.createOffer(function(b){b.sdp=pa(b.sdp);a.setLocalDescription(b,function(){this.send("setConfigurations",b)}.bind(this),r)}.bind(this),r,l.mediaConstraints)};n.prototype.setConfigurations=function(a){var b=this.conn,c=new RTCSessionDescription(a);if(this.closed)return alert("[ERROR] - Connection got interuppted. Please reload !");b.setRemoteDescription(c,function(){this._candidates&&this.setIceCandidates(this._candidates);if("offer"===a.type)b.createAnswer(function(a){a.sdp=pa(a.sdp);b.setLocalDescription(a,
function(){this.send("setConfigurations",a)}.bind(this),r)}.bind(this),null,l.mediaConstraints);else if(!Object.keys(this.channels).length)for(var c=Object.keys(Y),d=0,f=c.length;d<f;d++)this.createDataChannel(c[d])}.bind(this),r)};n.prototype.createDataChannel=function(a){try{var b=this.conn.createDataChannel(a,{reliable:!1});this.channels[a]=new Z(b,this.info.remote)}catch(c){console.log("[Error] - Creating DataChannel (*)")}};n.prototype.send=function(a,b){if(this.info.pending){var c=this.info.remote;
if(this.info.transport)return this.info.transport.send("register",b,{action:a,local:f.id,remote:c});if("update"===a)return console.log("[ERROR] - Update",b);SOCKET.send({action:a,data:b,remote:c})}else this.send=Fa.bind(this),this.send(a,b)};n.prototype.close=function(a){var b=this.channels,c=Object.keys(b);a||(a=c);Array.isArray(a)||(a=[a]);for(var c=0,e=a.length;c<e;c++)b[a[c]].channel.close(),delete b[a[c]];Object.keys(b).length||this.conn.close()};var V=100,aa={},ya=function(){var a=Object.keys(m),
b={};b[f.time]=f.id;for(var c=0,e=a.length;c<e;c++)b[m[a[c]].time]=a[c];var d=Object.keys(b).sort(function(a,b){return a-b}).map(function(a){return b[a]});if(d.length!==a.length+1)return console.log("[ERROR] Precision time conflict.",d,a);c=L.length=0;for(e=d.length;c<e;c++)a=m[d[c]]||f,a.pos=L.push(a.data)-1},za={};MANAGER={check:function(a,b){if(a){Array.isArray(a)||(a=[a]);for(var c=f.id,e,d=0,g=a.length;d<g;d++)e=a[d],e!==c&&!j[e]&&this.connect(e,!0,b)}},connect:function(a,b,c){j[a]||(m[a]=new v({id:a}),
j[a]=new n(f.id,a,b,c))},disconnect:function(a){var b=m[a];delete aa[a];f.emit("disconnect",b);I.emit("leave",b);j[a].close();L.splice(b.pos,1);delete m[a];delete j[a];ya()},set:function(a,b){j[a.local]||this.connect(a.local,!1,b);j[a.local][a.action](a.data)},update:function(a,b){for(var c=Object.keys(j),e=0,d=c.length;e<d;e++)j[c[e]].send("update",{key:a,value:b})},setup:function(a,b,c){function e(a,b){return a+b}if(c){if(c=za[a],c[b]=d.performance.now()-c[b],!(0<--c[0])){m[a].latency=c.reduce(e)/
(c.length-1);ya();a:{a=function(a){aa[a.id]||(aa[a.id]=!0,f.emit("connection",a),I.emit("enter",a))};b=Object.keys(m);c=[];var g;c[f.pos]=f;for(var h=0,l=b.length;h<l;h++){g=m[b[h]];if(!g.time)break a;c[g.pos]=g}h=0;for(l=c.length;h<l;h++)setTimeout(a,V,c[h])}}}else{b=function(a){setTimeout(function(){p.send("ping",{index:a})},Math.random()*n)};var p=j[a],n=100;a=za[a]=[n];for(c=1;c<=n;c++)a[c]=d.performance.now(),b(c)}}};s(C,{route:null});var Ja={GITHUB:function(){},PERSONA:function(){var a=document.createElement("script");
a.addEventListener("load",function(){navigator.id.watch({loggedInUser:localStorage.user||"",onlogin:function(a){console.log(a)},onlogout:function(){}});navigator.id.request()});a.src="https://login.persona.org/include.js";document.getElementsByTagName("script")[0].parentNode.insertBefore(a)}},Aa={},Ba={},U=null,S="/lobby/";d.addEventListener("hashchange",ra);d.addEventListener("popstate",function(){ka&&(ka=!ka)});var ga={},y=sa(J);A(J,q);J.prototype.init=function(a){this.id=a;q.call(this)};J.prototype.config=
function(a){s(this.options,a)};var T={},E=null,h=sa(w);A(w,J);w.prototype.start=function(a){this._start=function(){a();ta.call(this)};var b=Object.keys(aa).length;if(!(b<this.options.minPlayer))if(b===this.options.minPlayer)0===f.pos&&this._start();else if(b>this.options.minPlayer&&f.pos>=this.options.minPlayer)a:for(var b=Object.keys(m),c=f.pos,e=0,d=b.length;e<d;e++)if(c-1===m[b[e]].pos){j[b[e]].send("start",{request:!0});break a}};w.prototype.end=function(){};w.prototype.pause=function(){};w.prototype.unpause=
function(){};var ba=function(a,b,c,d){this.info={local:a,remote:b,pending:!0};c&&(this.info.initiator=!0);d&&(this.info.transport=d);this.channels={};this.init()};ba.prototype.init=function(){this.conn=new RTCPeerConnection(l.peerConfig,l.connectionConstraints);this.checkStateChanges();this.findICECandidates();this.info.initiator&&this.requestStream()};A(ba,n);ba.prototype.attachStream=function(){var a=this.conn;a.onaddstream=function(a){console.log("[MEDIA] - Added Stream");console.log(a)};a.onremovestream=
function(a){console.log("[MEDIA] - Removed Stream");URL.revokeObjectURL(a.stream)}};ba.prototype.requestStream=function(a){d.navigator.getUserMedia({audio:!0,video:!0},function(b){b.getVideoTracks();b.getAudioTracks();conn.addStream(b);if(a){var c=document.createElement("video");c.src=createObjectURL(b);c.autoplay=!0;document.getElementById(a).appendChild(c)}})};var v=function(a){this.init(a.id,a.account||{},a.data||{})};A(v,q);v.prototype.init=function(a,b,c){this.id=a;this.account=b;this.data=c;
this.pos=L.push(this.data)-1;q.call(this,a)};var P={},f={on:function(a,b,c){P[a]||(P[a]=[]);P[a].push([b,c])}},H=function(a,b){var c,d=new Uint8Array(1),f,g;c="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){f=crypto.getRandomValues(d)[0]%16;g="x"===a?f:f&3|8;return g.toString(16)});var h=fa(MANAGER.update);this.time=Date.now();this.init(c,a,h);Object.keys(P).length&&(N[this.id]=P);console.log("\n\t\t:: "+this.id+" ::\n");if(M)return setImmediate(function(){MANAGER.check(["SERVERLESS"])});
h=function(){SOCKET.init(c,b)};if(!u.length)return h();u.push(h)};A(H,v);H.prototype.join=function(a,b){"string"!==typeof a&&(a=a.toString());"/"===a.charAt(0)&&(a=a.substr(1));var c=["!/",a,Ca(b)].join("");"/"!==c.charAt(c.length-1)&&(c+="/");if(c==="!/"+D.currentRoute)return ra();d.location.hash=c};H.prototype.send=function(a,b){b||(b=a,a=null);"string"!==typeof b&&(b=b.toString());a||(a=Object.keys(j));Array.isArray(a)||(a=[a]);for(var c=0,d=a.length;c<d;c++)j[a[c]].send("message",{local:this.name,
msg:b})};H.prototype.media=function(){};var W=!1,ua=null;K.stop=function(){W=!1};K.resume=function(){K(ua)};p.addEventListener(X,function(){var a=p.title.split("[PAUSE]").pop();p.hidden||K.stop();p.title=(p.hidden?"[PAUSE] - ":"")+a});var Ka=function(){ca=null;for(var a=Object.keys(da),b,c=0,d=a.length;c<d;c++)b=a[c],ha(b,da[b]),delete da[b];E&&E()},da={},ca=null,R=fa(function(a,b){da[a]=b;ca&&clearTimeout(ca);ca=setTimeout(Ka,V)}),x={},ia={};s(B,{noConflict:function(){G.pg=Ha;return this},VERSION:g,
info:C,config:z,login:function(a,b,c){"function"===typeof b&&(c=b,b=null);if(b)return b=b.toUpperCase(),Ja[b]?(qa({name:a},c),a=void 0):a=console.log("[ERROR] The chosen service is not supported yet."),a;qa({name:a},c)},player:f,peers:m,data:L,sync:R,loop:K,channel:y,game:h,routes:function(a,b){!b&&"string"===typeof a&&(b=a,a=null);a&&(Aa={},Ba={});b&&(S=b);return[Aa,Ba,S]}});return B});
